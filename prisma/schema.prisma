generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Complaint {
  id                String                @id @default(uuid())
  originalEmailId   String                @unique
  subject           String
  status            ComplaintStatus       @default(NEW)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  resolutionStatus  ResolutionStatus      @default(PENDING)
  crReviewStatus    CRReviewStatus        @default(PENDING)
  investigationGrid Json?                 // Complete investigation grid
  conversation      ConversationMessage[]
}

model Passenger {
  pnr          String @id
  customerName String
  flightNumber String
  seatNumber   String
  source       String
  destination  String
  flightDate   DateTime @default(now())
}

model ConversationMessage {
  id          String      @id @default(uuid())
  complaintId String
  authorType  AuthorType
  messageType MessageType
  content     Json
  createdAt   DateTime    @default(now())
  complaint   Complaint   @relation(fields: [complaintId], references: [id])
}

enum ComplaintStatus {
  NEW
  WAITING_OPS
  PROCESSING
  DRAFT_READY
  APPROVED
  RESOLVED
  MISSING_INFO
}

enum AuthorType {
  CX
  AGENT
  BASE_OPS
}

enum MessageType {
  EMAIL
  GRID
  DRAFT
  FINAL
}

enum CRReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ResolutionStatus {
  PENDING
  RESOLVED
  FLAGGED
}

model FlightWeather {
  id                 String   @id @default(uuid())
  flightNumber       String
  date               DateTime // Date of the flight
  originStation      String   // e.g., "DEL"
  destinationStation String   // e.g., "BOM"

  // METAR Data (Structured)
  metarRaw    String
  wind        String?
  visibility  String?
  weather     String? // e.g., "HZ (Haze)"
  clouds      String?
  temperature String?

  impact String? // e.g., "Minor delays possible due to reduced visibility"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([flightNumber, date, originStation]) // Ensure unique weather record per flight-leg
}
