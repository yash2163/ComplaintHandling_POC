generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ComplaintStatus {
  NEW
  WAITING_OPS
  PROCESSING
  DRAFT_READY
  APPROVED
  RESOLVED
  MISSING_INFO
}

enum AuthorType {
  CX
  AGENT
  BASE_OPS
}

enum MessageType {
  EMAIL
  GRID
  DRAFT
  FINAL
}

enum ResolutionStatus {
  PENDING
  RESOLVED
  FLAGGED
}

model Complaint {
  id               String   @id @default(uuid())
  originalEmailId  String   @unique
  subject          String
  status           ComplaintStatus @default(NEW)
  originStation    String?  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // New PNR-related fields
  pnr              String?
  customerName     String?
  flightNumber     String?
  seatNumber       String?
  source           String?
  destination      String?
  complaintDetail  String?

  // Agent 2 Evaluation
  resolutionStatus ResolutionStatus @default(PENDING)
  agentReasoning   String?          // Why Agent 2 thinks it is resolved or flagged
  resolutionSummary String?         // Summary of the resolution provided by Ops
  
  conversation     ConversationMessage[]
}

model Passenger {
  pnr          String @id
  customerName String
  flightNumber String
  seatNumber   String
  source       String
  destination  String
}

model ConversationMessage {
  id          String      @id @default(uuid())
  complaintId String
  authorType  AuthorType
  messageType MessageType
  content     Json
  createdAt   DateTime    @default(now())
  
  complaint   Complaint   @relation(fields: [complaintId], references: [id])
}
